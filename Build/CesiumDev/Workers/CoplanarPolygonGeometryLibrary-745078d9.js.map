{"version":3,"file":"CoplanarPolygonGeometryLibrary-745078d9.js","sources":["../../../packages/engine/Source/Core/CoplanarPolygonGeometryLibrary.js"],"sourcesContent":["import Cartesian2 from \"./Cartesian2.js\";\r\nimport Cartesian3 from \"./Cartesian3.js\";\r\nimport Check from \"./Check.js\";\r\nimport Matrix3 from \"./Matrix3.js\";\r\nimport OrientedBoundingBox from \"./OrientedBoundingBox.js\";\r\n\r\n/**\r\n * @private\r\n */\r\nconst CoplanarPolygonGeometryLibrary = {};\r\n\r\nconst scratchIntersectionPoint = new Cartesian3();\r\nconst scratchXAxis = new Cartesian3();\r\nconst scratchYAxis = new Cartesian3();\r\nconst scratchZAxis = new Cartesian3();\r\nconst obbScratch = new OrientedBoundingBox();\r\n\r\nCoplanarPolygonGeometryLibrary.validOutline = function (positions) {\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.defined(\"positions\", positions);\r\n  //>>includeEnd('debug');\r\n\r\n  const orientedBoundingBox = OrientedBoundingBox.fromPoints(\r\n    positions,\r\n    obbScratch\r\n  );\r\n  const halfAxes = orientedBoundingBox.halfAxes;\r\n  const xAxis = Matrix3.getColumn(halfAxes, 0, scratchXAxis);\r\n  const yAxis = Matrix3.getColumn(halfAxes, 1, scratchYAxis);\r\n  const zAxis = Matrix3.getColumn(halfAxes, 2, scratchZAxis);\r\n\r\n  const xMag = Cartesian3.magnitude(xAxis);\r\n  const yMag = Cartesian3.magnitude(yAxis);\r\n  const zMag = Cartesian3.magnitude(zAxis);\r\n\r\n  // If all the points are on a line return undefined because we can't draw a polygon\r\n  return !(\r\n    (xMag === 0 && (yMag === 0 || zMag === 0)) ||\r\n    (yMag === 0 && zMag === 0)\r\n  );\r\n};\r\n\r\n// call after removeDuplicates\r\nCoplanarPolygonGeometryLibrary.computeProjectTo2DArguments = function (\r\n  positions,\r\n  centerResult,\r\n  planeAxis1Result,\r\n  planeAxis2Result\r\n) {\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.defined(\"positions\", positions);\r\n  Check.defined(\"centerResult\", centerResult);\r\n  Check.defined(\"planeAxis1Result\", planeAxis1Result);\r\n  Check.defined(\"planeAxis2Result\", planeAxis2Result);\r\n  //>>includeEnd('debug');\r\n\r\n  const orientedBoundingBox = OrientedBoundingBox.fromPoints(\r\n    positions,\r\n    obbScratch\r\n  );\r\n  const halfAxes = orientedBoundingBox.halfAxes;\r\n  const xAxis = Matrix3.getColumn(halfAxes, 0, scratchXAxis);\r\n  const yAxis = Matrix3.getColumn(halfAxes, 1, scratchYAxis);\r\n  const zAxis = Matrix3.getColumn(halfAxes, 2, scratchZAxis);\r\n\r\n  const xMag = Cartesian3.magnitude(xAxis);\r\n  const yMag = Cartesian3.magnitude(yAxis);\r\n  const zMag = Cartesian3.magnitude(zAxis);\r\n  const min = Math.min(xMag, yMag, zMag);\r\n\r\n  // If all the points are on a line return undefined because we can't draw a polygon\r\n  if (\r\n    (xMag === 0 && (yMag === 0 || zMag === 0)) ||\r\n    (yMag === 0 && zMag === 0)\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  let planeAxis1;\r\n  let planeAxis2;\r\n\r\n  if (min === yMag || min === zMag) {\r\n    planeAxis1 = xAxis;\r\n  }\r\n  if (min === xMag) {\r\n    planeAxis1 = yAxis;\r\n  } else if (min === zMag) {\r\n    planeAxis2 = yAxis;\r\n  }\r\n  if (min === xMag || min === yMag) {\r\n    planeAxis2 = zAxis;\r\n  }\r\n\r\n  Cartesian3.normalize(planeAxis1, planeAxis1Result);\r\n  Cartesian3.normalize(planeAxis2, planeAxis2Result);\r\n  Cartesian3.clone(orientedBoundingBox.center, centerResult);\r\n  return true;\r\n};\r\n\r\nfunction projectTo2D(position, center, axis1, axis2, result) {\r\n  const v = Cartesian3.subtract(position, center, scratchIntersectionPoint);\r\n  const x = Cartesian3.dot(axis1, v);\r\n  const y = Cartesian3.dot(axis2, v);\r\n\r\n  return Cartesian2.fromElements(x, y, result);\r\n}\r\n\r\nCoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction = function (\r\n  center,\r\n  axis1,\r\n  axis2\r\n) {\r\n  return function (positions) {\r\n    const positionResults = new Array(positions.length);\r\n    for (let i = 0; i < positions.length; i++) {\r\n      positionResults[i] = projectTo2D(positions[i], center, axis1, axis2);\r\n    }\r\n\r\n    return positionResults;\r\n  };\r\n};\r\n\r\nCoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction = function (\r\n  center,\r\n  axis1,\r\n  axis2\r\n) {\r\n  return function (position, result) {\r\n    return projectTo2D(position, center, axis1, axis2, result);\r\n  };\r\n};\r\nexport default CoplanarPolygonGeometryLibrary;\r\n"],"names":["Cartesian3","OrientedBoundingBox","Check","Matrix3","Cartesian2"],"mappings":"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"}